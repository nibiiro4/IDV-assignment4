<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3.js Interactive Grouped Bar Chart</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .controls {
            text-align: center;
            margin-bottom: 20px;
        }
        .chart-container {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .tooltip {
            position: absolute;
            text-align: left;
            padding: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: 0px;
            border-radius: 4px;
            pointer-events: none;
            font-size: 12px;
            line-height: 1.4;
            opacity: 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .axis text {
            font-size: 10px;
        }
        .chart-title {
            font-size: 16px;
            font-weight: bold;
            text-anchor: middle;
        }
        select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>Model Performance Metrics (Std Acc, CRR, CRA)</h1>
    <p style="text-align: center; font-style: italic;">(Interaction: Select Dataset to filter; Hover for detail; Transition: Smooth bar update)</p>

    <div class="controls">
        <label for="dataset-select">Select Dataset:</label>
        <select id="dataset-select"></select>
    </div>
    
    <div class="chart-container">
        <div id="chart-area"></div>
    </div>

    <div class="tooltip" id="tooltip-container"></div>

    <script>
        const jsonString = `[
            {"Approach":"ERM","Dataset":"CIFAR100","Metric_Type":"Std Acc","Value":81.03},
            {"Approach":"DA","Dataset":"CIFAR100","Metric_Type":"Std Acc","Value":78.27},
            {"Approach":"PGDT","Dataset":"CIFAR100","Metric_Type":"Std Acc","Value":64.35},
            {"Approach":"TRADES","Dataset":"CIFAR100","Metric_Type":"Std Acc","Value":62.55},
            {"Approach":"MART","Dataset":"CIFAR100","Metric_Type":"Std Acc","Value":63.68},
            {"Approach":"RS","Dataset":"CIFAR100","Metric_Type":"Std Acc","Value":56.87},
            {"Approach":"IBP","Dataset":"CIFAR100","Metric_Type":"Std Acc","Value":39.45},
            {"Approach":"PRL","Dataset":"CIFAR100","Metric_Type":"Std Acc","Value":64.89},
            {"Approach":"TandT","Dataset":"CIFAR100","Metric_Type":"Std Acc","Value":65.56},
            {"Approach":"ERM","Dataset":"CIFAR10","Metric_Type":"Std Acc","Value":94.85},
            {"Approach":"DA","Dataset":"CIFAR10","Metric_Type":"Std Acc","Value":94.21},
            {"Approach":"PGDT","Dataset":"CIFAR10","Metric_Type":"Std Acc","Value":84.38},
            {"Approach":"TRADES","Dataset":"CIFAR10","Metric_Type":"Std Acc","Value":80.42},
            {"Approach":"MART","Dataset":"CIFAR10","Metric_Type":"Std Acc","Value":81.54},
            {"Approach":"RS","Dataset":"CIFAR10","Metric_Type":"Std Acc","Value":89.45},
            {"Approach":"IBP","Dataset":"CIFAR10","Metric_Type":"Std Acc","Value":48.4},
            {"Approach":"PRL","Dataset":"CIFAR10","Metric_Type":"Std Acc","Value":93.82},
            {"Approach":"TandT","Dataset":"CIFAR10","Metric_Type":"Std Acc","Value":94.23},
            {"Approach":"ERM","Dataset":"SVHN","Metric_Type":"Std Acc","Value":94.44},
            {"Approach":"DA","Dataset":"SVHN","Metric_Type":"Std Acc","Value":94.69},
            {"Approach":"PGDT","Dataset":"SVHN","Metric_Type":"Std Acc","Value":91.19},
            {"Approach":"TRADES","Dataset":"SVHN","Metric_Type":"Std Acc","Value":86.16},
            {"Approach":"MART","Dataset":"SVHN","Metric_Type":"Std Acc","Value":90.2},
            {"Approach":"RS","Dataset":"SVHN","Metric_Type":"Std Acc","Value":88.35},
            {"Approach":"IBP","Dataset":"SVHN","Metric_Type":"Std Acc","Value":73.09},
            {"Approach":"PRL","Dataset":"SVHN","Metric_Type":"Std Acc","Value":92.0},
            {"Approach":"TandT","Dataset":"SVHN","Metric_Type":"Std Acc","Value":94.79},
            {"Approach":"ERM","Dataset":"MNIST","Metric_Type":"Std Acc","Value":99.37},
            {"Approach":"DA","Dataset":"MNIST","Metric_Type":"Std Acc","Value":99.42},
            {"Approach":"PGDT","Dataset":"MNIST","Metric_Type":"Std Acc","Value":99.16},
            {"Approach":"TRADES","Dataset":"MNIST","Metric_Type":"Std Acc","Value":99.1},
            {"Approach":"MART","Dataset":"MNIST","Metric_Type":"Std Acc","Value":98.94},
            {"Approach":"RS","Dataset":"MNIST","Metric_Type":"Std Acc","Value":97.16},
            {"Approach":"IBP","Dataset":"MNIST","Metric_Type":"Std Acc","Value":97.78},
            {"Approach":"PRL","Dataset":"MNIST","Metric_Type":"Std Acc","Value":99.32},
            {"Approach":"TandT","Dataset":"MNIST","Metric_Type":"Std Acc","Value":99.32},
            {"Approach":"ERM","Dataset":"CIFAR100","Metric_Type":"CRR","Value":9.28},
            {"Approach":"DA","Dataset":"CIFAR100","Metric_Type":"CRR","Value":15.04},
            {"Approach":"PGDT","Dataset":"CIFAR100","Metric_Type":"CRR","Value":57.07},
            {"Approach":"TRADES","Dataset":"CIFAR100","Metric_Type":"CRR","Value":59.27},
            {"Approach":"MART","Dataset":"CIFAR100","Metric_Type":"CRR","Value":58.79},
            {"Approach":"RS","Dataset":"CIFAR100","Metric_Type":"CRR","Value":60.38},
            {"Approach":"IBP","Dataset":"CIFAR100","Metric_Type":"CRR","Value":49.34},
            {"Approach":"PRL","Dataset":"CIFAR100","Metric_Type":"CRR","Value":56.71},
            {"Approach":"TandT","Dataset":"CIFAR100","Metric_Type":"CRR","Value":62.05},
            {"Approach":"ERM","Dataset":"CIFAR10","Metric_Type":"CRR","Value":1.25},
            {"Approach":"DA","Dataset":"CIFAR10","Metric_Type":"CRR","Value":81.08},
            {"Approach":"PGDT","Dataset":"CIFAR10","Metric_Type":"CRR","Value":87.07},
            {"Approach":"TRADES","Dataset":"CIFAR10","Metric_Type":"CRR","Value":88.54},
            {"Approach":"MART","Dataset":"CIFAR10","Metric_Type":"CRR","Value":78.9},
            {"Approach":"RS","Dataset":"CIFAR10","Metric_Type":"CRR","Value":90.0},
            {"Approach":"IBP","Dataset":"CIFAR10","Metric_Type":"CRR","Value":54.7},
            {"Approach":"PRL","Dataset":"CIFAR10","Metric_Type":"CRR","Value":90.71},
            {"Approach":"TandT","Dataset":"CIFAR10","Metric_Type":"CRR","Value":95.08},
            {"Approach":"ERM","Dataset":"SVHN","Metric_Type":"CRR","Value":52.72},
            {"Approach":"DA","Dataset":"SVHN","Metric_Type":"CRR","Value":82.08},
            {"Approach":"PGDT","Dataset":"SVHN","Metric_Type":"CRR","Value":87.89},
            {"Approach":"TRADES","Dataset":"SVHN","Metric_Type":"CRR","Value":87.89},
            {"Approach":"MART","Dataset":"SVHN","Metric_Type":"CRR","Value":85.23},
            {"Approach":"RS","Dataset":"SVHN","Metric_Type":"CRR","Value":76.29},
            {"Approach":"IBP","Dataset":"SVHN","Metric_Type":"CRR","Value":61.94},
            {"Approach":"PRL","Dataset":"SVHN","Metric_Type":"CRR","Value":93.11},
            {"Approach":"TandT","Dataset":"SVHN","Metric_Type":"CRR","Value":93.15},
            {"Approach":"ERM","Dataset":"MNIST","Metric_Type":"CRR","Value":26.01},
            {"Approach":"DA","Dataset":"MNIST","Metric_Type":"CRR","Value":85.23},
            {"Approach":"PGDT","Dataset":"MNIST","Metric_Type":"CRR","Value":94.65},
            {"Approach":"TRADES","Dataset":"MNIST","Metric_Type":"CRR","Value":94.76},
            {"Approach":"MART","Dataset":"MNIST","Metric_Type":"CRR","Value":94.13},
            {"Approach":"RS","Dataset":"MNIST","Metric_Type":"CRR","Value":87.15},
            {"Approach":"IBP","Dataset":"MNIST","Metric_Type":"CRR","Value":89.18},
            {"Approach":"PRL","Dataset":"MNIST","Metric_Type":"CRR","Value":96.03},
            {"Approach":"TandT","Dataset":"MNIST","Metric_Type":"CRR","Value":97.8},
            {"Approach":"ERM","Dataset":"CIFAR100","Metric_Type":"CRA","Value":4.52},
            {"Approach":"DA","Dataset":"CIFAR100","Metric_Type":"CRA","Value":6.15},
            {"Approach":"PGDT","Dataset":"CIFAR100","Metric_Type":"CRA","Value":32.93},
            {"Approach":"TRADES","Dataset":"CIFAR100","Metric_Type":"CRA","Value":38.85},
            {"Approach":"MART","Dataset":"CIFAR100","Metric_Type":"CRA","Value":49.37},
            {"Approach":"RS","Dataset":"CIFAR100","Metric_Type":"CRA","Value":47.5},
            {"Approach":"IBP","Dataset":"CIFAR100","Metric_Type":"CRA","Value":29.2},
            {"Approach":"PRL","Dataset":"CIFAR100","Metric_Type":"CRA","Value":50.77},
            {"Approach":"TandT","Dataset":"CIFAR100","Metric_Type":"CRA","Value":52.07},
            {"Approach":"ERM","Dataset":"CIFAR10","Metric_Type":"CRA","Value":1.25},
            {"Approach":"DA","Dataset":"CIFAR10","Metric_Type":"CRA","Value":76.07},
            {"Approach":"PGDT","Dataset":"CIFAR10","Metric_Type":"CRA","Value":82.9},
            {"Approach":"TRADES","Dataset":"CIFAR10","Metric_Type":"CRA","Value":78.8},
            {"Approach":"MART","Dataset":"CIFAR10","Metric_Type":"CRA","Value":72.21},
            {"Approach":"RS","Dataset":"CIFAR10","Metric_Type":"CRA","Value":87.98},
            {"Approach":"IBP","Dataset":"CIFAR10","Metric_Type":"CRA","Value":40.0},
            {"Approach":"PRL","Dataset":"CIFAR10","Metric_Type":"CRA","Value":90.63},
            {"Approach":"TandT","Dataset":"CIFAR10","Metric_Type":"CRA","Value":91.75},
            {"Approach":"ERM","Dataset":"SVHN","Metric_Type":"CRA","Value":51.04},
            {"Approach":"DA","Dataset":"SVHN","Metric_Type":"CRA","Value":82.01},
            {"Approach":"PGDT","Dataset":"SVHN","Metric_Type":"CRA","Value":86.68},
            {"Approach":"TRADES","Dataset":"SVHN","Metric_Type":"CRA","Value":84.76},
            {"Approach":"MART","Dataset":"SVHN","Metric_Type":"CRA","Value":78.82},
            {"Approach":"RS","Dataset":"SVHN","Metric_Type":"CRA","Value":70.64},
            {"Approach":"IBP","Dataset":"SVHN","Metric_Type":"CRA","Value":57.26},
            {"Approach":"PRL","Dataset":"SVHN","Metric_Type":"CRA","Value":91.07},
            {"Approach":"TandT","Dataset":"SVHN","Metric_Type":"CRA","Value":92.81},
            {"Approach":"ERM","Dataset":"MNIST","Metric_Type":"CRA","Value":24.96},
            {"Approach":"DA","Dataset":"MNIST","Metric_Type":"CRA","Value":84.12},
            {"Approach":"PGDT","Dataset":"MNIST","Metric_Type":"CRA","Value":94.63},
            {"Approach":"TRADES","Dataset":"MNIST","Metric_Type":"CRA","Value":94.61},
            {"Approach":"MART","Dataset":"MNIST","Metric_Type":"CRA","Value":94.09},
            {"Approach":"RS","Dataset":"MNIST","Metric_Type":"CRA","Value":86.29},
            {"Approach":"IBP","Dataset":"MNIST","Metric_Type":"CRA","Value":88.51},
            {"Approach":"PRL","Dataset":"MNIST","Metric_Type":"CRA","Value":95.01},
            {"Approach":"TandT","Dataset":"MNIST","Metric_Type":"CRA","Value":96.8}
        ]`;
        
        const fullData = JSON.parse(jsonString);

        const margin = {top: 50, right: 120, bottom: 80, left: 60};
        const width = 850 - margin.left - margin.right;
        const height = 550 - margin.top - margin.bottom;

        const svg = d3.select("#chart-area")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        const tooltip = d3.select("#tooltip-container");

        const approaches = Array.from(new Set(fullData.map(d => d.Approach)));
        const datasets = Array.from(new Set(fullData.map(d => d.Dataset)));
        const metrics = Array.from(new Set(fullData.map(d => d.Metric_Type)));

        const x0 = d3.scaleBand()
            .domain(approaches)
            .range([0, width])
            .paddingInner(0.1);

        const x1 = d3.scaleBand()
            .domain(metrics)
            .range([0, x0.bandwidth()])
            .padding(0.05);

        const y = d3.scaleLinear()
            .domain([0, 100])
            .range([height, 0]);

        const colorScale = d3.scaleOrdinal()
            .domain(metrics)
            .range(d3.schemeCategory10);

        const xAxisGroup = svg.append("g")
            .attr("class", "x axis")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x0).tickSizeOuter(0))
            .selectAll("text")
            .attr("transform", "rotate(-45)")
            .style("text-anchor", "end");
            
        svg.append("text")
            .attr("class", "axis-label")
            .attr("x", width / 2)
            .attr("y", height + margin.bottom - 10)
            .style("text-anchor", "middle")
            .text("Machine Learning Approach");

        const yAxisGroup = svg.append("g")
            .attr("class", "y axis")
            .call(d3.axisLeft(y).tickFormat(d => `${d}%`));
            
        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("y", 0 - margin.left + 15)
            .attr("x", 0 - (height / 2))
            .style("text-anchor", "middle")
            .text("Performance Value (%)");
        
        const chartTitle = svg.append("text")
            .attr("class", "chart-title")
            .attr("x", width / 2)
            .attr("y", -20)
            .text("Performance Metrics by Approach (Dataset: CIFAR100)");

        const legend = svg.append("g")
            .attr("class", "legend")
            .attr("transform", `translate(${width + 20}, 0)`); 

        metrics.forEach((d, i) => {
            const legendRow = legend.append("g")
                .attr("transform", `translate(0, ${i * 20})`);

            legendRow.append("rect")
                .attr("width", 10)
                .attr("height", 10)
                .attr("fill", colorScale(d));

            legendRow.append("text")
                .attr("x", 15)
                .attr("y", 9)
                .attr("text-anchor", "start")
                .style("font-size", "12px")
                .text(d);
        });

        const select = d3.select("#dataset-select");

        select.selectAll("option")
            .data(datasets)
            .enter()
            .append("option")
            .attr("value", d => d)
            .text(d => d);
            
        select.property("value", datasets[0]);

        select.on("change", function(event) {
            const newDataset = event.target.value;
            drawChart(newDataset);
        });

        function drawChart(selectedDataset) {
            const filteredData = fullData.filter(d => d.Dataset === selectedDataset);
            
            const nestedData = d3.group(filteredData, d => d.Approach);

            chartTitle.text(`Performance Metrics by Approach (Dataset: ${selectedDataset})`);
            
            const approachGroups = svg.selectAll(".approachGroup")
                .data(nestedData, d => d[0]);
            
            approachGroups.exit().remove();
            
            const approachGroupsEnter = approachGroups.enter().append("g")
                .attr("class", "approachGroup")
                .attr("transform", ([key, values]) => `translate(${x0(key)}, 0)`);

            const mergedApproachGroups = approachGroupsEnter.merge(approachGroups)
                .attr("transform", ([key, values]) => `translate(${x0(key)}, 0)`);

            const bars = mergedApproachGroups.selectAll("rect")
                .data(([key, values]) => values, d => d.Metric_Type);

            bars.exit().remove();

            bars.enter().append("rect")
                .attr("x", d => x1(d.Metric_Type))
                .attr("width", x1.bandwidth())
                .attr("fill", d => colorScale(d.Metric_Type))
                .attr("y", y(0)) 
                .attr("height", 0)
                
                .merge(bars)
                .on("mouseover", mouseover)
                .on("mouseout", mouseout)
                .on("mousemove", mousemove)
                
                .transition()
                .duration(1000)
                .delay((d, i) => i * 50) 
                
                .attr("x", d => x1(d.Metric_Type))
                .attr("width", x1.bandwidth())
                .attr("y", d => y(d.Value)) 
                .attr("height", d => height - y(d.Value)); 
        }
        
        const mouseover = function(event, d) {
            d3.select(this)
                .attr("stroke", "#000")
                .attr("stroke-width", 2)
                .attr("opacity", 0.8);
            
            tooltip.transition()
                .duration(200)
                .style("opacity", 1);
        };
        
        const mousemove = function(event, d) {
             tooltip.html(`
                <strong>Dataset:</strong> ${d.Dataset}<br>
                <strong>Approach:</strong> ${d.Approach}<br>
                <strong>Metric:</strong> ${d.Metric_Type}<br>
                <strong>Value:</strong> ${d.Value.toFixed(2)}%
            `)
            .style("left", (event.pageX + 15) + "px")
            .style("top", (event.pageY - 30) + "px");
        };

        const mouseout = function(event, d) {
            d3.select(this)
                .attr("stroke", "none")
                .attr("opacity", 1);
                
            tooltip.transition()
                .duration(500)
                .style("opacity", 0);
        };

        drawChart(datasets[0]);
    
    </script>
</body>
</html>
